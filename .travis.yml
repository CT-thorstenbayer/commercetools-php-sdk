language: php
php:
  - "5.6"
  - "5.5"
  - "5.4"
  - "7.0"
  - "hhvm"

matrix:
  allow_failures:
    - php: hhvm
    - php: "7.0"

services:
  - redis-server

cache:
  directories:
  - vendor

before_script:
  - composer config -g github-oauth.github.com $GITHUB_OAUTH_TOKEN
  - sh -c "if [ $TRAVIS_PHP_VERSION != 'hhvm' ] ; then echo 'extension = redis.so' >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini ; fi"
  - sh -c "if [ $TRAVIS_PHP_VERSION != 'hhvm' ] && [ `php-config --vernum` -ge 50500 ] && [ `php-config --vernum` -le 70000 ]; then printf "yes\n" | pecl install -f apcu-4.0.10 ; else echo 'extension="apc.so"' >> ./tests/apc.ini ; fi"
  - sh -c "if [ $TRAVIS_PHP_VERSION != 'hhvm' ] && [ `php-config --vernum` -ge 70000 ] ; then printf "yes\n" | pecl install -f apcu ; fi"
  - sh -c "if [ $TRAVIS_PHP_VERSION != 'hhvm' ] ; then phpenv config-add ./tests/apc.ini; fi"
  - if [ $TRAVIS_PHP_VERSION == '5.4' ] ; then ./set_guzzle5.sh; fi
  - composer install -o

script:
  - ant phpcs-ci
  - phpunit --testsuite=unit
  - if [ $TRAVIS_PHP_VERSION == '5.6' ] ; then phpunit --testsuite=integration; fi
  - ant behat

after_success:
  - ./push-docs-to-gh-pages.sh

env:
  global:
    # GH_TOKEN environment variable for pushing documentation:
    - secure: "i0TL7GsZ8TIZgr7WB5qXEs8fF5sSJHGagLXEsn4DSgxI52GatfjeEaSJuAbbWV/Tg0jYidNevdhCpe7LT3IWwa2cLVRpaV1TDoQ6K4wo8zzMzAw4AMB8DO2dBY3Mz+puRN55YAV3OpEF/RiiIc7zXLW/+5H9UCOXrcnnpg6PpxE="
    # SPHERE_CLIENT_ID
    - secure: MEht7kleJ/K9/daNOjEpPNJnXxKyQZ36oEM8fImi612BoJmZp/uwjuKpqKscIyyLwXSpsr7c9w+V2CfSk3QI+NGLnhSNgjJWE2QXxzxD6OgM0gKFTDtBq//+k77Sx4UnQDi0pQPRZ1BrfBUqrxw4H07i53hXd/kmjZnknRcbODc=
    # SPHERE_CLIENT_SECRET
    - secure: Q4zRyFxLw/7YlHG/iWzyR7V7Srm8LsQ3UgMshckUyqefhzhF19GefoPJdPdALyLVEYQMG3O/U1aebbyt8Puy5jWWKKiwFaQA+mMXzpBFcvhutgxByqBXdIysIhGU65No+WbiCKlpL2WPNtYvE1cMSjFfn7IX8ThGkBxhJQcha38=
    # SPHERE_PROJECT
    - secure: CPj46vCtmLaxGKXycJW+PmNXloXu5ruOV/Qg1mA6tU83oPjlxHVrqMOlb87ykf6U8X6XXAjMrgR0q3gBepPJg3HZmJyeOsVhwSU/jhfN7L1lR7BrQrPdLutvhuC6Fgj+b2Ubzh7PIt7pR6AYZyMCv5ofajW9aBcC5D556WJsSjE=
notifications:
  hipchat:
    rooms:
      secure: VD5RvUZYVg1aokw8OeMhNfDPc39o2r4Jjq8s6U2QvMXzoiopHpj6+VYX1AHbhxMpBGmsgKfzbYQ6XfubJUeHq+FMzW3YEekwcyqXKCfWi5tLCE7Epb0dCySatztVTkqlXzXaAM6NhzdFxG6kQPiA9OcSvRPZmSwjuX4eYXRokRw=
